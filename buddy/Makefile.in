all:

GCC_UNDEF_FLAG=-undefined dynamic_lookup
LDFLAGS=
#gcc >=4.2
#LDFLAGS=$(GCC_UNDEF_FLAG)

LIB_SRCS=upk_buddy.c
LIB_OBJS=${LIB_SRCS:.c=.o}
LIB=libupk_buddy.so

$(LIB): $(LIB_OBJS)
	gcc -shared -lsqlite3 $(LDFLAGS) -o $(LIB) $(LIB_OBJS)

test: $(MAIN)
	LD_LIBRARY_PATH=. ./buddytest

$(MAIN): $(MAIN_OBJS) $(LIB)
	cc -o $(MAIN) $(LIB) -lsqlite3 $(MAIN_OBJS) $(EXT_LIBS)

clean:
	rm -f *.o $(MAIN) $(LIB)

.SUFFIXES: .o .c

.c.o:
	$(CC) $(CFLAGS) -c $<
%:
	@$(MAKE) -C ..
