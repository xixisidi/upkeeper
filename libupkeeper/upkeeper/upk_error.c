#include "std_include.h"
#include "error.h"
#include <stdio.h>

static void             _upk_default_error_rpt(upk_error_t err);
static void             _upk_default_error_rpt_msg(upk_error_t err, unsigned const char *msg);

/* *******************************************************************************************************************
 * ****************************************************************************************************************** */
__UPK_ERRORS_ARRAY;

/* *******************************************************************************************************************
 * ****************************************************************************************************************** */
err_rpt_callback_t      __upk_error_rpt_callback = _upk_default_error_rpt;
err_rpt_msg_callback_t  __upk_error_rpt_msg_callback = _upk_default_error_rpt_msg;

/* *******************************************************************************************************************
 * ****************************************************************************************************************** */
const unsigned char    *
upk_strerror(upk_error_t err)
{
    if(err < sizeof(__upk_errors))
        return __upk_errors[err];
    else
        return __upk_errors[0];
}


/* *******************************************************************************************************************
 * ****************************************************************************************************************** */
static void
_upk_default_error_rpt(upk_error_t err)
{
    fprintf(stderr, "Error: `%s'\n", upk_strerror(err));
}

/* *******************************************************************************************************************
 * ****************************************************************************************************************** */
static void
_upk_default_error_rpt_msg(upk_error_t err, unsigned const char *msg)
{
    fprintf(stderr, "Error: `%s': %s\n", upk_strerror(err), msg);
}

/* *******************************************************************************************************************
 * ****************************************************************************************************************** */
void
upk_report_error(upk_error_t err)
{
    __upk_error_rpt_callback(err);
}

/* *******************************************************************************************************************
 * ****************************************************************************************************************** */
void
upk_report_error_msg(upk_error_t err, unsigned const char *msg)
{
    __upk_error_rpt_msg_callback(err, msg);
}

/* *******************************************************************************************************************
 * ****************************************************************************************************************** */
err_rpt_callback_t
upk_reg_error_callback(err_rpt_callback_t func)
{
    err_rpt_callback_t      oldfunc = __upk_error_rpt_callback;

    __upk_error_rpt_callback = func;
    return oldfunc;
}

/* *******************************************************************************************************************
 * ****************************************************************************************************************** */
err_rpt_msg_callback_t
upk_reg_err_msg_callback(err_rpt_msg_callback_t func)
{
    err_rpt_msg_callback_t  oldfunc = __upk_error_rpt_msg_callback;

    __upk_error_rpt_msg_callback = func;
    return oldfunc;
}
