<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>upkeeper: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">upkeeper&#160;<span id="projectnumber">1</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">upkeeper Documentation</div>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="whatis"></a>
What is Upkeeper.</h2>
<p>Upkeeper is a process control, monitor, with auditing system.</p>
<p>Upkeeper consists of 4 logical components</p>
<ul>
<li>Buddy - The individual process monitor.</li>
<li>Controller - The audit and control service.</li>
<li>Libupkeeper - The client library.</li>
<li>Clients - tools and utilities to interact with upkeeper.</li>
</ul>
<p>upkeeper's is almost between DJB's daemontools, and freedesktop's systemd, in terms of functionality and capabilities. However, it adds the additional capability of recording state changes of monitored processes to a data store, which can then be interogated, preferably via the API, for the purpose troubleshooting, event correlation, metrics collection, trending, and analysis.</p>
<h2><a class="anchor" id="howitworks"></a>
How the system works:</h2>
<p>A high-level view of the interaction between components is as follows:</p>
<div align="center">
<img src="dot_inline_dotgraph_1.png" alt="dot_inline_dotgraph_1.png" border="0" usemap="#dot_inline_dotgraph_1.map">
<map name="dot_inline_dotgraph_1.map" id="dot_inline_dotgraph_1.map"></map>
</div>
<p>Controller is responsible for maintaining the configuration of buddy process, establishing the environment in which buddy runs, and invoking buddies. Once a buddy has been invoked, it runs autonymously until terminated. Excessive care has been taken to ensure that a buddy will not terminate under normal, and even some rather extraordinary, circumstances.</p>
<p>Buddy is a simplistic-by-design component that primarily just sits in a loop and waits for the process its monitoring to change terminate, or otherwise catch a signal. To communicate status changes with controller, buddy listens to a socket, which controller polls at a configurable interval. If controller dies for some reason, buddy has a user-configurably sized ringbuffer which will backlog status events, and report them once a controller becomes available. If a ringbuffer becomes &gt;= 75% full, or if a buddy is attempting to terminate while having events in its ringbuffer, the buddy will attempt to contact a controller on the controller's domain socket, as a last-resort.</p>
<p>The environment buddy runs in is a directory structure with files and symlinks that buddy uses to invoke actions, and log output. </p>
<div align="center">
<img src="dot_inline_dotgraph_2.png" alt="dot_inline_dotgraph_2.png" border="0" usemap="#dot_inline_dotgraph_2.map">
<map name="dot_inline_dotgraph_2.map" id="dot_inline_dotgraph_2.map"></map>
</div>
<p>Clients consist of things like "uptop", which is a status reporting tool that is similar to the common "top" utility. Clients communicate with controller via the API provided in libupkeeper. Hence, you can easily create any client you require, including metrics reporting and/or monitoring and alerting systems.</p>
<p>To explain this, the following sequence chart demonstrates how the components interact:</p>
<p>Start a managed process:</p>
<div align="center">
<img src="msc_inline_mscgraph_1.png" alt="msc_inline_mscgraph_1" border="0" usemap="#msc_inline_mscgraph_1.map">
<map name="msc_inline_mscgraph_1.map" id="msc_inline_mscgraph_1.map"></map>
</div>
<p>Whereas a read-only process, such as subscribing to, and receiving events over time would look like this:</p>
<div align="center">
<img src="msc_inline_mscgraph_2.png" alt="msc_inline_mscgraph_2" border="0" usemap="#msc_inline_mscgraph_2.map">
<map name="msc_inline_mscgraph_2.map" id="msc_inline_mscgraph_2.map"></map>
</div>
<h2><a class="anchor" id="sampleconfig"></a>
Sample Configuration.</h2>
<div class="fragment"><pre class="fragment">
{
    // StateDir
    // Path to variable state-dir for controller and buddies
    "StateDir": "/usr/var/upkeeper",

    // SvcConfigPath
    // Path to location of service configuration files
    "SvcConfigPath": "/usr/etc/upkeeper.d",

    // SvcRunPath
    // Path to location to setup and run buddies
    "SvcRunPath": "/usr/var/upkeeper/buddies",

    // Path to the buddy executable
    "UpkBuddyPath": "/usr/libexec/upk_buddy",

    // How frequently buddy sockets should be polled for events
    // in seconds and fractions of a second
    "BuddyPollingInterval": 0.5,

    // ServiceDefaults:
    "ServiceDefaults": {
        "Provides": Null,
        "UUID": Null,
        "ShortDescription": Null,
        "LongDescription": Null,
        "Prerequisites": Null,
        "StartPriority": 0,
        "BuddyShutdownTimeout": -1,
        "KillTimeout": 60,
        "UserMaxRestarts": Null,
        "UserRestartWindow": Null,
        "UserRateLimit": Null,
        "RandomizeRateLimit": false,
        "SetUID": 0,
        "SetGID": 0,
        "RingbufferSize": 64,
        "ReconnectRetries": 10,
        "ExecStart": Null,
        "StartScript": "#!/bin/sh\nexec %(EXEC_START)\n",
        "ExecStop": "kill",
        "StopScript": "#!/bin/sh\nexec %(EXEC_STOP) $1\n",
        "ExecReload": "kill -HUP",
        "ReloadScript": "#!/bin/sh\nexec %(EXEC_RELOAD) $1\n",
        "CustomActions": Null,
        "PipeStdoutScript": Null,
        "PipeStderrScript": Null,
        "RedirectStdout": Null,
        "RedirectStderr": Null,
        "InitialState": "stopped",
        "UnconfigureOnFileRemoval": false,
        "PreferBuddyStateForStopped": false,
        "PreferBuddyStateForRunning": true,
    },
}
</pre></div> </div></div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 1 2011 for upkeeper by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
